import React, { useState, useMemo } from 'react';
import { 
  Moon, ShoppingBag, Menu, X, Star, Sparkles, Instagram, 
  Facebook, Plus, Minus, Trash2, Cat, Leaf, Sun, 
  Edit3, Save, Scissors, PenTool, Heart, ArrowRight
} from 'lucide-react';

// --- ELEMENTOS DE ATMOSFERA ---

const EstrelaFofa = ({ style }) => (
  <svg 
    viewBox="0 0 24 24" 
    fill="currentColor" 
    className="absolute text-yellow-300 drop-shadow-[0_0_8px_rgba(253,224,71,0.8)] opacity-40 animate-pulse"
    style={style}
  >
    <path d="M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z" />
  </svg>
);

const FundoMistico = () => {
  const stars = useMemo(() => [...Array(25)].map((_, i) => ({
    id: i,
    top: `${Math.random() * 100}%`,
    left: `${Math.random() * 100}%`,
    size: Math.random() * 20 + 10,
    blur: Math.random() * 4,
    delay: Math.random() * 5,
    duration: 3 + Math.random() * 4
  })), []);

  return (
    <div className="fixed inset-0 pointer-events-none overflow-hidden z-0 bg-[#0f110e]">
      {/* Luzes de fundo sutis */}
      <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-emerald-900/10 blur-[120px] rounded-full" />
      <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-900/10 blur-[120px] rounded-full" />
      
      {stars.map(s => (
        <EstrelaFofa 
          key={s.id} 
          style={{
            top: s.top,
            left: s.left,
            width: s.size,
            height: s.size,
            filter: `blur(${s.blur}px)`,
            animationDelay: `${s.delay}s`,
            animationDuration: `${s.duration}s`
          }}
        />
      ))}
      <div className="absolute inset-0 opacity-[0.03] mix-blend-overlay" style={{backgroundImage: `url('https://www.transparenttextures.com/patterns/handmade-paper.png')`}} />
    </div>
  );
};

const LogoOficina = () => (
  <div className="relative w-16 h-16 flex items-center justify-center group">
    <Moon className="absolute w-12 h-12 text-[#d4af37] fill-[#d4af37]/5 -rotate-12 group-hover:rotate-0 transition-transform duration-700" strokeWidth={1} />
    <Cat className="absolute w-7 h-7 text-stone-900 fill-stone-900 bottom-2 left-3" strokeWidth={1.5} />
    <Star className="absolute w-4 h-4 text-yellow-200 fill-yellow-200 top-1 right-2 animate-bounce" />
  </div>
);

// --- COMPONENTES DE INTERFACE ---

export default function App() {
  const [isCartOpen, setIsCartOpen] = useState(false);
  const [isEditMode, setIsEditMode] = useState(false);
  const [cart, setCart] = useState([]);
  
  const [products, setProducts] = useState([
    {
      id: 1,
      name: 'Cadernos Artesanais (A5 e A6)',
      price: 45.00,
      description: 'Costurados à mão, papel pólen 90g. Revestimento em tecido + papel kraft. Aproximadamente 3h30 de produção dedicada.',
      image: 'https://images.unsplash.com/photo-1544816153-12ad5d714b21?auto=format&fit=crop&w=800&q=80',
      specs: 'Papel Pólen 90g | Costura Manual | Capa Tecido'
    },
    {
      id: 2,
      name: 'Brincos Artesanais',
      price: 15.00,
      description: 'Peças autorais com estética artística e identidade própria. Leves, confortáveis e design exclusivo.',
      image: 'https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?auto=format&fit=crop&w=800&q=80',
      specs: 'Design Exclusivo | Produção Manual | Leveza'
    },
    {
      id: 3,
      name: 'Incensário Artesanal',
      price: 40.00,
      description: 'Peça decorativa funcional, com estética mística e natural. Resistente ao calor e modelado à mão.',
      image: 'https://images.unsplash.com/photo-1602928321679-560bb453f190?auto=format&fit=crop&w=800&q=80',
      specs: 'Cerâmica/Argila | Resistente | Autoral'
    },
    {
      id: 4,
      name: 'Caixinha de Joias',
      price: 60.00,
      description: 'Caixa decorativa artesanal para guardar acessórios. Estrutura firme e acabamento detalhado em tecido.',
      image: 'https://images.unsplash.com/photo-1582142306909-195724d339c4?auto=format&fit=crop&w=800&q=80',
      specs: 'Papel Paraná | Revestimento Tecido | Detalhado'
    }
  ]);

  const handleEdit = (id, field, value) => {
    setProducts(prev => prev.map(p => p.id === id ? { ...p, [field]: value } : p));
  };

  const addToCart = (p) => {
    setCart(prev => {
      const exists = prev.find(item => item.id === p.id);
      if (exists) return prev.map(item => item.id === p.id ? { ...item, qty: item.qty + 1 } : item);
      return [...prev, { ...p, qty: 1 }];
    });
    setIsCartOpen(true);
  };

  const cartTotal = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);

  const checkout = () => {
    const msg = cart.map(i => `${i.qty}x ${i.name}`).join('%0A');
    window.open(`https://wa.me/5511999999999?text=Oi Oficina da Lua! ✨%0AGostaria dessas peças:%0A${msg}%0ATotal: R$ ${cartTotal.toFixed(2)}`);
  };

  return (
    <div className="min-h-screen text-[#e2e2d5] font-serif overflow-x-hidden">
      <FundoMistico />

      {/* Interface Controls */}
      <button 
        onClick={() => setIsEditMode(!isEditMode)}
        className="fixed bottom-8 left-8 z-[100] bg-[#d4af37] text-stone-950 p-4 rounded-full shadow-2xl hover:scale-105 transition-all flex items-center gap-2 font-sans font-bold text-xs uppercase tracking-widest"
      >
        {isEditMode ? <Save size={18} /> : <Edit3 size={18} />}
        {isEditMode ? 'Salvar Alterações' : 'Modo Ateliê'}
      </button>

      {/* Header */}
      <header className="relative z-50 py-10 px-8">
        <div className="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-8 border-b border-stone-800/50 pb-10">
          <div className="flex items-center gap-6">
            <LogoOficina />
            <div>
              <h1 className="text-3xl font-bold tracking-tighter text-[#d4af37] leading-none">OFICINA DA LUA</h1>
              <p className="font-sans text-[10px] uppercase tracking-[0.4em] text-stone-500 mt-2">Arte que se segura nas mãos</p>
            </div>
          </div>
          
          <nav className="flex items-center gap-10 font-sans text-[11px] uppercase tracking-[0.2em] text-stone-400">
            <a href="#produtos" className="hover:text-[#d4af37] transition-colors">Produtos</a>
            <a href="#sobre" className="hover:text-[#d4af37] transition-colors">O Processo</a>
            <button onClick={() => setIsCartOpen(true)} className="relative p-2 hover:text-[#d4af37] transition-colors">
              <ShoppingBag size={22} strokeWidth={1.5} />
              {cart.length > 0 && <span className="absolute top-0 right-0 w-4 h-4 bg-[#d4af37] text-stone-950 rounded-full text-[9px] flex items-center justify-center font-bold">{cart.length}</span>}
            </button>
          </nav>
        </div>
      </header>

      {/* Hero - Diagramação Editorial */}
      <section className="relative z-10 max-w-7xl mx-auto px-8 py-20 grid md:grid-cols-12 gap-12 items-center">
        <div className="md:col-span-7 space-y-10 order-2 md:order-1">
          <div className="space-y-4">
            <div className="flex items-center gap-4 text-[#d4af37]">
              <div className="h-px w-12 bg-[#d4af37]" />
              <span className="font-sans text-[10px] uppercase tracking-[0.5em]">Ateliê Autoral</span>
            </div>
            <h2 className="text-6xl md:text-8xl font-bold italic leading-[0.9] tracking-tighter">
              A presença do <br/>
              <span className="text-[#d4af37] not-italic">feito à mão.</span>
            </h2>
          </div>
          <p className="text-xl text-stone-400 max-w-xl leading-relaxed font-light">
            Não vendemos apenas objetos. Vendemos tempo, intenção e a textura da alma aplicada ao cotidiano. Cada peça é uma conversa entre a artista e a matéria.
          </p>
          <div className="flex items-center gap-8 pt-4">
            <a href="#produtos" className="group flex items-center gap-4 text-[#d4af37] font-sans text-xs uppercase tracking-widest font-bold">
              Explorar Coleção <ArrowRight className="group-hover:translate-x-2 transition-transform" />
            </a>
          </div>
        </div>
        
        <div className="md:col-span-5 order-1 md:order-2">
          <div className="relative group">
            <div className="absolute -inset-4 border border-stone-800 rounded-[2rem] transform group-hover:rotate-3 transition-transform duration-1000" />
            <img 
              src="https://images.unsplash.com/photo-1513689125086-6c432170e843?auto=format&fit=crop&w=800&q=80" 
              className="relative z-10 w-full rounded-[2rem] shadow-2xl grayscale hover:grayscale-0 transition-all duration-1000 object-cover aspect-[4/5]"
              alt="Ateliê"
            />
          </div>
        </div>
      </section>

      {/* Seção de Produtos - Grid Assimétrico */}
      <section id="produtos" className="relative z-10 max-w-7xl mx-auto px-8 py-40">
        <div className="mb-32 flex flex-col md:flex-row md:items-end gap-6">
          <h3 className="text-5xl font-bold tracking-tighter">O Mercado da Lua</h3>
          <div className="h-px flex-1 bg-stone-800 mb-4" />
          <p className="font-sans text-[10px] uppercase tracking-[0.3em] text-stone-500">Tiragens Únicas & Limitadas</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-x-20 gap-y-32">
          {products.map((p, idx) => (
            <div key={p.id} className={`flex flex-col space-y-8 ${idx % 2 !== 0 ? 'md:mt-32' : ''}`}>
              {/* Imagem do Produto com Moldura */}
              <div className="relative group overflow-hidden bg-stone-900 border border-stone-800 shadow-2xl">
                {isEditMode ? (
                  <div className="absolute inset-0 z-20 bg-stone-900/90 p-4 flex flex-col justify-center gap-2">
                    <label className="text-[10px] uppercase text-stone-500">Link da Imagem</label>
                    <input 
                      className="bg-stone-800 p-2 text-xs text-white" 
                      value={p.image} 
                      onChange={e => handleEdit(p.id, 'image', e.target.value)}
                    />
                  </div>
                ) : null}
                <img 
                  src={p.image} 
                  className="w-full aspect-[4/5] object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-1000"
                  alt={p.name}
                />
                <button 
                  onClick={() => addToCart(p)}
                  className="absolute bottom-6 right-6 z-20 bg-[#d4af37] text-stone-950 p-4 rounded-full opacity-0 translate-y-4 group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-500 shadow-xl"
                >
                  <Plus size={20} />
                </button>
              </div>

              {/* Detalhes do Produto */}
              <div className="space-y-6 px-2">
                <div className="flex justify-between items-start gap-4">
                  <div className="space-y-2">
                    {isEditMode ? (
                      <input 
                        className="bg-transparent border-b border-[#d4af37] text-3xl font-bold w-full outline-none" 
                        value={p.name} 
                        onChange={e => handleEdit(p.id, 'name', e.target.value)}
                      />
                    ) : (
                      <h4 className="text-3xl font-bold">{p.name}</h4>
                    )}
                    <span className="font-sans text-[10px] uppercase tracking-widest text-[#d4af37] block italic">{p.specs}</span>
                  </div>
                  <div className="text-right">
                    {isEditMode ? (
                      <input 
                        className="bg-transparent border-b border-[#d4af37] text-2xl font-bold w-20 text-right outline-none" 
                        type="number"
                        value={p.price} 
                        onChange={e => handleEdit(p.id, 'price', parseFloat(e.target.value))}
                      />
                    ) : (
                      <span className="text-2xl font-bold text-[#d4af37]">R${p.price.toFixed(2)}</span>
                    )}
                  </div>
                </div>

                {isEditMode ? (
                  <textarea 
                    className="bg-stone-900/50 border border-stone-800 text-stone-400 p-4 w-full h-32 text-sm leading-relaxed" 
                    value={p.description} 
                    onChange={e => handleEdit(p.id, 'description', e.target.value)}
                  />
                ) : (
                  <p className="text-stone-400 leading-relaxed font-light text-lg">
                    {p.description}
                  </p>
                )}
                
                <div className="flex items-center gap-3 text-stone-600 font-sans text-[10px] uppercase tracking-widest">
                  <Scissors size={14} /> 100% Manual
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* Manifesto */}
      <section id="sobre" className="relative z-10 py-40 border-t border-stone-800/50 bg-stone-900/20">
        <div className="max-w-4xl mx-auto px-8 text-center space-y-12">
          <Heart size={40} className="mx-auto text-[#d4af37]/30" />
          <h2 className="text-4xl md:text-6xl font-bold tracking-tighter">Produção real, identidade autoral.</h2>
          <p className="text-xl text-stone-500 leading-relaxed font-light">
            No Ateliê Oficina da Lua, o tempo não é inimigo, é o principal material. 
            Levamos mais de 3 horas para costurar cada caderno. Modelamos cada cinzeiro com paciência. 
            É uma rebeldia contra o mundo plástico: aqui, as coisas têm peso, textura e nome.
          </p>
          <div className="inline-flex items-center gap-4 text-[#d4af37] font-sans text-xs uppercase tracking-widest font-bold border-b border-[#d4af37] pb-2 cursor-pointer hover:text-yellow-500 transition-colors">
            Conheça os Bastidores <ArrowRight size={14} />
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="relative z-10 py-20 px-8 bg-stone-950 border-t border-stone-900">
        <div className="max-w-7xl mx-auto flex flex-col items-center gap-12">
          <LogoOficina />
          <div className="flex gap-10">
            <Instagram className="text-stone-700 hover:text-[#d4af37] transition-colors cursor-pointer" />
            <Facebook className="text-stone-700 hover:text-[#d4af37] transition-colors cursor-pointer" />
          </div>
          <div className="text-center space-y-2">
            <p className="font-sans text-[10px] uppercase tracking-[0.5em] text-stone-700">© 2026 Oficina da Lua • Feito com intenção no Brasil</p>
            <div className="flex justify-center gap-4 text-stone-800">
              <Sparkles size={12} />
              <Star size={12} />
              <Sparkles size={12} />
            </div>
          </div>
        </div>
      </footer>

      {/* Cart Sidebar */}
      {isCartOpen && (
        <div className="fixed inset-0 z-[200] flex justify-end">
          <div className="absolute inset-0 bg-stone-950/90 backdrop-blur-md" onClick={() => setIsCartOpen(false)} />
          <div className="relative w-full max-w-md bg-[#121412] h-full shadow-2xl border-l border-stone-800 p-10 flex flex-col animate-in slide-in-from-right duration-500">
            <div className="flex justify-between items-center mb-12">
              <h3 className="text-2xl font-bold italic tracking-tighter">Sacola Mística</h3>
              <button onClick={() => setIsCartOpen(false)} className="p-2 text-stone-500 hover:text-white"><X /></button>
            </div>
            
            <div className="flex-1 overflow-y-auto space-y-8 pr-4 custom-scrollbar">
              {cart.length === 0 ? (
                <div className="h-full flex flex-col items-center justify-center text-stone-700 gap-4">
                  <Moon size={40} strokeWidth={1} />
                  <p className="font-sans text-xs uppercase tracking-widest">Nada por aqui ainda.</p>
                </div>
              ) : (
                cart.map(item => (
                  <div key={item.id} className="flex gap-6 group">
                    <img src={item.image} className="w-16 h-20 object-cover border border-stone-800 group-hover:border-[#d4af37] transition-colors" />
                    <div className="flex-1">
                      <h5 className="font-bold text-sm">{item.name}</h5>
                      <p className="text-[#d4af37] text-xs font-sans mt-1">R$ {item.price.toFixed(2)}</p>
                      <div className="flex items-center gap-4 mt-3">
                        <button onClick={() => {
                          setCart(prev => prev.map(i => i.id === item.id ? {...i, qty: Math.max(0, i.qty - 1)} : i).filter(i => i.qty > 0))
                        }} className="text-stone-600 hover:text-white"><Minus size={14} /></button>
                        <span className="text-xs font-sans font-bold">{item.qty}</span>
                        <button onClick={() => {
                          setCart(prev => prev.map(i => i.id === item.id ? {...i, qty: i.qty + 1} : i))
                        }} className="text-stone-600 hover:text-white"><Plus size={14} /></button>
                      </div>
                    </div>
                  </div>
                ))
              )}
            </div>

            {cart.length > 0 && (
              <div className="pt-10 border-t border-stone-800 space-y-8">
                <div className="flex justify-between items-end">
                  <span className="font-sans text-xs uppercase tracking-widest text-stone-500">Total da Magia</span>
                  <span className="text-3xl font-bold text-[#d4af37]">R$ {cartTotal.toFixed(2)}</span>
                </div>
                <button 
                  onClick={checkout}
                  className="w-full bg-[#d4af37] text-stone-950 py-5 font-sans font-bold text-xs uppercase tracking-[0.3em] hover:bg-yellow-500 transition-all flex items-center justify-center gap-3 shadow-xl"
                >
                  <Sparkles size={16} /> Enviar Encomenda
                </button>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
